## 项目简介

ChatMemOllama 是一个个人微信公众号聊天机器人，结合了本地 AI 模型（由 Ollama 提供）和 mem0 记忆管理功能。该项目旨在提供一个智能、个性化的聊天体验。
注意！使用mem0的版本仅为早期测试版，速度慢且设计不科学(仅依靠mem0不科学)，请先使用旧版
请等待后续更新 欢迎提交pr
目前测试加入tool calling让ai调用函数执行，已经实现让ai使用搜索引擎(未发布)

## 功能特性

- **本地 AI 模型**：使用 Ollama 提供的本地 AI 模型进行对话。
- **记忆管理**：通过 mem0 管理用户的聊天记忆，提供更连贯的对话体验。
- **多用户支持**：支持多个用户同时进行对话（测试版存在逻辑问题）。
- **快速响应**：尽量在 5 秒内回复用户，超时情况下会提示用户等待。

## 安装与使用

### 环境要求

- Python 3.7+
- Flask
- FastAPI
- WeChatPy
- Ollama

### 安装步骤

1. 克隆仓库：
    ```bash
    git clone https://github.com/yourusername/ChatMemOllama.git
    cd ChatMemOllama
    ```

2. 安装依赖：
    ```bash
    pip install -r requirements.txt
    ```

3. 配置环境变量：
    ```bash
    export WECHAT_TOKEN='your_wechat_token'
    export APPID='your_appid'
    export APPSECRET='your_appsecret'
    export EncodingAESKey='your_encoding_aes_key'
    ```

4. 运行应用：
    ```bash
    python justchat.py
    ```

## 贡献指南

欢迎任何形式的贡献！请确保在提交 PR 之前阅读以下指南：

1. Fork 仓库并创建一个新的分支。
2. 提交您的修改并推送到您的分支。
3. 创建一个 Pull Request 并描述您的更改。

## 许可证

本项目基于 Apache 2.0 许可证进行分发。详情请参阅 [LICENSE](./LICENSE) 文件。

## 联系方式

如有任何问题或建议，请通过 email 联系我：lightjunction.me@gmail.com

## 作者的话
感谢大家对这个项目的喜欢
作者的想法是将本ai打造为个人的，能持久记忆的，能轻松访问本地文件的一个智能体。
实现这个完全是可行的，我第一步探索了使用微信官方的接口并连接到我的公众号，并写出了第一版的代码，这个在项目第一天晚上即成功了
然后我开始学习并运用mem0管理记忆，但是我没想到mem0做向量库检索会这么慢，而且我也不清楚微信公众号会有5秒的超时限制，以至于我一度怀疑是我的服务器处理响应有逻辑错误

这里快速介绍一下收发消息的流程
首先
程序启动，代码会在@post后面等待一条post请求
这是客户端发来的消息
然后我将这个request传递给我的处理post请求的函数
先将request的参数统一提取出来保存为json格式msg_info
然后依次进行解密_将XML格式转换为json
传递给AI生成回复
然后加密，还原XML格式后return这个XML加密内容_这里注意使用PlainTextResponse

整个过程需要控制时间在5秒内（未认证公众号没有主动回复消息接口）
于是我在第二版将逻辑修改为用户提问立马返回一个；请稍加发送"继续"
来规避超时的问题

我规划第三版基本逻辑是：
异步接受响应，然后AI生成回复时采用多线程处理
为了结合第一版和第二版的优点
像第一版一样能及时回答用户的提问，同时ai需要有长期记忆
1.规定历史聊天记录为最近的k条
2.用tool calling的方式，让AI自主决定是保存记忆还是提取记忆，这将在另外一个进程执行，不会阻塞主进程，k这个值设置的越大，那么供mem0处理记忆的时间就足够长，体验也会较好__记忆说白了就是messages一个列表，记录的是{“role”:$role,"content":}role的可选值是 system，user ， assistant ，tool 
/*至于能不能是其他值，这个我还真试了，我把role 填”meta开发者“，xxx，结果ai就完全不听我的promot，一刻不停一直输出莫名其妙的东西，给我输出过一个网站的网页数据，关于食谱的，而且这个网页还能访问，的确是关于食品的。还输出过奇奇怪怪的文件内容，甚至有页脚document 第几页 等等... 
总而言之，role不要填小明，小红之类的
两个特殊的role是system和tool*/
然后就是如何做出各种有意思的tool了
在我知道tool calling这个功能之前，我一度想造个让ai根据用户说的内容来做决策，将结果规范化输出的轮子，直到我知道tool calling这个，我一拍大腿，这不就是我想要的吗？
那么接下来的工作，就是利用好tool calling实现各种好玩的功能

比如？
狗语翻译器怎么样？让ai决策后调用狗语翻译器加密消息
决策后选择狗语翻译器，这个挺有意思的，我第一个想到的是“佛曰加密“具体可以自己去在线体验下
又或者？
让ai调用本地文件，告诉用户xxx/xx文件里面有啥内容，这完全是可行的！
又或者？
让ai自己不停地在网上收集资料，然后保存在一个文件？而这些都只用在微信公众号发送个消息即可。

考虑到个人计算机的算力有限，对于对多用户的体验必然很糟糕。
那么其实是可以搞一个管理员菜单的
我已经搞过一个，但是没发出来，是在第二版的基础上改的
发送：sudo su进入管理员模式，如果用户的openid为管理员的id即可进入这个模式，执行比如清除全部用户记忆的操作之类的！
那么也可以是开关一些功能，比如允许其他用户调用ai。如果关闭，还是能启用最基本的关键词回复的。这样，人少的时候，就跟公众号发个消息，允许其他用户调用AI...
这种感觉就跟运行一个CLI程序一样...

最后的最后，我还得感谢大家对这个项目的喜爱，对于我而言，这个项目的星星✨数出乎我意料的高，比我前面几个repo的星星多得多

这个真的对我是一种莫大的鼓励，谢谢！
2024.10.9





